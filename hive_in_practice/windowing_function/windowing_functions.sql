from sales
select id, amount, day, 
sum(amount) 
over (order by day rows between unbounded preceding and current row)
as running_total;

-- 1	10.0	2018-03-01	10.0
-- 2	15.0	2018-03-02	25.0
-- 3	30.0	2018-03-02	55.0
-- 4	25.0	2018-03-02	80.0
-- 5	15.0	2018-03-03	95.0
-- 6	30.0	2018-03-03	125.0
-- 7	35.0	2018-03-03	160.0
-- 8	20.0	2018-03-03	180.0
-- 9	10.0	2018-03-04	190.0
-- 10	5.0	2018-03-04	195.0
-- 11	10.0	2018-03-04	205.0
-- 12	30.0	2018-03-04	235.0
-- 13	10.0	2018-03-05	245.0
-- 14	15.0	2018-03-05	260.0
-- 15	30.0	2018-03-05	290.0


from sales
select id, amount, day, 
sum(amount) 
over (order by day rows between unbounded preceding and unbounded following)
as running_total;

-- 1	10.0	2018-03-01	290.0
-- 2	15.0	2018-03-02	290.0
-- 3	30.0	2018-03-02	290.0
-- 4	25.0	2018-03-02	290.0
-- 5	15.0	2018-03-03	290.0
-- 6	30.0	2018-03-03	290.0
-- 7	35.0	2018-03-03	290.0
-- 8	20.0	2018-03-03	290.0
-- 9	10.0	2018-03-04	290.0
-- 10	5.0	2018-03-04	290.0
-- 11	10.0	2018-03-04	290.0
-- 12	30.0	2018-03-04	290.0
-- 13	10.0	2018-03-05	290.0
-- 14	15.0	2018-03-05	290.0
-- 15	30.0	2018-03-05	290.0


from sales
select id, amount, day, 
sum(amount) 
over (order by day rows between 2 preceding and 2 following)
as running_total;

-- 1	10.0	2018-03-01	55.0
-- 2	15.0	2018-03-02	80.0
-- 3	30.0	2018-03-02	95.0
-- 4	25.0	2018-03-02	115.0
-- 5	15.0	2018-03-03	135.0
-- 6	30.0	2018-03-03	125.0
-- 7	35.0	2018-03-03	110.0
-- 8	20.0	2018-03-03	100.0
-- 9	10.0	2018-03-04	80.0
-- 10	5.0	2018-03-04	75.0
-- 11	10.0	2018-03-04	65.0
-- 12	30.0	2018-03-04	70.0
-- 13	10.0	2018-03-05	95.0
-- 14	15.0	2018-03-05	85.0
-- 15	30.0	2018-03-05	55.0


from sales
select id, amount, day, 
max(amount) 
over (order by day rows between unbounded preceding and current row)
as running_total;

-- 1	10.0	2018-03-01	10.0
-- 2	15.0	2018-03-02	15.0
-- 3	30.0	2018-03-02	30.0
-- 4	25.0	2018-03-02	30.0
-- 5	15.0	2018-03-03	30.0
-- 6	30.0	2018-03-03	30.0
-- 7	35.0	2018-03-03	35.0
-- 8	20.0	2018-03-03	35.0
-- 9	10.0	2018-03-04	35.0
-- 10	5.0	2018-03-04	35.0
-- 11	10.0	2018-03-04	35.0
-- 12	30.0	2018-03-04	35.0
-- 13	10.0	2018-03-05	35.0
-- 14	15.0	2018-03-05	35.0
-- 15	30.0	2018-03-05	35.0

from sales
select id, amount, day, 
avg(amount) 
over (order by day rows between unbounded preceding and current row)
as running_avg;


-- 1	10.0	2018-03-01	10.0
-- 2	15.0	2018-03-02	12.5
-- 3	30.0	2018-03-02	18.333333333333332
-- 4	25.0	2018-03-02	20.0
-- 5	15.0	2018-03-03	19.0
-- 6	30.0	2018-03-03	20.833333333333332
-- 7	35.0	2018-03-03	22.857142857142858
-- 8	20.0	2018-03-03	22.5
-- 9	10.0	2018-03-04	21.11111111111111
-- 10	5.0	2018-03-04	19.5
-- 11	10.0	2018-03-04	18.636363636363637
-- 12	30.0	2018-03-04	19.583333333333332
-- 13	10.0	2018-03-05	18.846153846153847
-- 14	15.0	2018-03-05	18.571428571428573
-- 15	30.0	2018-03-05	19.333333333333332

from sales
select id, amount, day, 
avg(amount) 
over (order by day rows between unbounded preceding and unbounded following)
as running_avg;

-- 1	10.0	2018-03-01	19.333333333333332
-- 2	15.0	2018-03-02	19.333333333333332
-- 3	30.0	2018-03-02	19.333333333333332
-- 4	25.0	2018-03-02	19.333333333333332
-- 5	15.0	2018-03-03	19.333333333333332
-- 6	30.0	2018-03-03	19.333333333333332
-- 7	35.0	2018-03-03	19.333333333333332
-- 8	20.0	2018-03-03	19.333333333333332
-- 9	10.0	2018-03-04	19.333333333333332
-- 10	5.0	2018-03-04	19.333333333333332
-- 11	10.0	2018-03-04	19.333333333333332
-- 12	30.0	2018-03-04	19.333333333333332
-- 13	10.0	2018-03-05	19.333333333333332
-- 14	15.0	2018-03-05	19.333333333333332
-- 15	30.0	2018-03-05	19.333333333333332

from sales
select id, amount, day, 
sum(amount) 
over (partition by day order by id rows between unbounded preceding and current row)
as running_total;

-- 9	10.0	2018-03-04	10.0
-- 10	5.0	2018-03-04	15.0
-- 11	10.0	2018-03-04	25.0
-- 12	30.0	2018-03-04	55.0
-- 1	10.0	2018-03-01	10.0
-- 13	10.0	2018-03-05	10.0
-- 14	15.0	2018-03-05	25.0
-- 15	30.0	2018-03-05	55.0
-- 2	15.0	2018-03-02	15.0
-- 3	30.0	2018-03-02	45.0
-- 4	25.0	2018-03-02	70.0
-- 5	15.0	2018-03-03	15.0
-- 6	30.0	2018-03-03	45.0
-- 7	35.0	2018-03-03	80.0
-- 8	20.0	2018-03-03	100.0


from sales
select id, amount, day, 
count(id) 
over (partition by day rows between unbounded preceding and unbounded following)
as running_count;

-- 9	10.0	2018-03-04	4
-- 10	5.0	2018-03-04	4
-- 11	10.0	2018-03-04	4
-- 12	30.0	2018-03-04	4
-- 1	10.0	2018-03-01	1
-- 13	10.0	2018-03-05	3
-- 14	15.0	2018-03-05	3
-- 15	30.0	2018-03-05	3
-- 2	15.0	2018-03-02	3
-- 3	30.0	2018-03-02	3
-- 4	25.0	2018-03-02	3
-- 5	15.0	2018-03-03	4
-- 6	30.0	2018-03-03	4
-- 7	35.0	2018-03-03	4
-- 8	20.0	2018-03-03	4

from sales
select id, amount, day, 
avg(amount) 
over (order by id rows between 3 preceding and current row)
as running_avg;

-- 1	10.0	2018-03-01	10.0
-- 2	15.0	2018-03-02	12.5
-- 3	30.0	2018-03-02	18.333333333333332
-- 4	25.0	2018-03-02	20.0
-- 5	15.0	2018-03-03	21.25
-- 6	30.0	2018-03-03	25.0
-- 7	35.0	2018-03-03	26.25
-- 8	20.0	2018-03-03	25.0
-- 9	10.0	2018-03-04	23.75
-- 10	5.0	2018-03-04	17.5
-- 11	10.0	2018-03-04	11.25
-- 12	30.0	2018-03-04	13.75
-- 13	10.0	2018-03-05	13.75
-- 14	15.0	2018-03-05	16.25
-- 15	30.0	2018-03-05	21.25

from sales
select id, amount, day, 
avg(amount) 
over (partition by day order by id rows between 2 preceding and current row)
as running_avg;

-- 9	10.0	2018-03-04	10.0
-- 10	5.0	2018-03-04	7.5
-- 11	10.0	2018-03-04	8.333333333333334
-- 12	30.0	2018-03-04	15.0
-- 1	10.0	2018-03-01	10.0
-- 13	10.0	2018-03-05	10.0
-- 14	15.0	2018-03-05	12.5
-- 15	30.0	2018-03-05	18.333333333333332
-- 2	15.0	2018-03-02	15.0
-- 3	30.0	2018-03-02	22.5
-- 4	25.0	2018-03-02	23.333333333333332
-- 5	15.0	2018-03-03	15.0
-- 6	30.0	2018-03-03	22.5
-- 7	35.0	2018-03-03	26.666666666666668
-- 8	20.0	2018-03-03	28.333333333333332


from sales
select id, amount, day, 
(amount * 100) / sum(amount) 
over (partition by day order by id rows between unbounded preceding and unbounded following)
as contribution;

-- 9	10.0	2018-03-04	18.181818181818183
-- 10	5.0	2018-03-04	9.090909090909092
-- 11	10.0	2018-03-04	18.181818181818183
-- 12	30.0	2018-03-04	54.54545454545455
-- 1	10.0	2018-03-01	100.0
-- 13	10.0	2018-03-05	18.181818181818183
-- 14	15.0	2018-03-05	27.272727272727273
-- 15	30.0	2018-03-05	54.54545454545455
-- 2	15.0	2018-03-02	21.428571428571427
-- 3	30.0	2018-03-02	42.857142857142854
-- 4	25.0	2018-03-02	35.714285714285715
-- 5	15.0	2018-03-03	15.0
-- 6	30.0	2018-03-03	30.0
-- 7	35.0	2018-03-03	35.0
-- 8	20.0	2018-03-03	20.0

from sales
select id, amount, day, 
row_number() 
over (partition by day order by amount)
as row_number;

-- 10	5.0	2018-03-04	1
-- 9	10.0	2018-03-04	2
-- 11	10.0	2018-03-04	3
-- 12	30.0	2018-03-04	4
-- 1	10.0	2018-03-01	1
-- 13	10.0	2018-03-05	1
-- 14	15.0	2018-03-05	2
-- 15	30.0	2018-03-05	3
-- 2	15.0	2018-03-02	1
-- 4	25.0	2018-03-02	2
-- 3	30.0	2018-03-02	3
-- 5	15.0	2018-03-03	1
-- 8	20.0	2018-03-03	2
-- 6	30.0	2018-03-03	3
-- 7	35.0	2018-03-03	4


from sales
select id, amount, day, 
rank()
over (partition by day order by amount)
as rank;

-- 10	5.0	2018-03-04	1
-- 9	10.0	2018-03-04	2
-- 11	10.0	2018-03-04	2
-- 12	30.0	2018-03-04	4
-- 1	10.0	2018-03-01	1
-- 13	10.0	2018-03-05	1
-- 14	15.0	2018-03-05	2
-- 15	30.0	2018-03-05	3
-- 2	15.0	2018-03-02	1
-- 4	25.0	2018-03-02	2
-- 3	30.0	2018-03-02	3
-- 5	15.0	2018-03-03	1
-- 8	20.0	2018-03-03	2
-- 6	30.0	2018-03-03	3
-- 7	35.0	2018-03-03	4

